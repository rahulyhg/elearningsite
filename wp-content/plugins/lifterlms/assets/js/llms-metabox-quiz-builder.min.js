!function(t){window.llms=window.llms||{},t.fn.getQuestionId=function(){var t=this.closest("tr.llms-question");return t.length?t.attr("data-question-id"):0},t.fn.llmsSelect2ify=function(){return this.select2({allowClear:!1,ajax:{dataType:"JSON",delay:250,method:"POST",url:window.ajaxurl,data:function(t){return{term:t.term,page:t.page?t.page-1:0,action:"query_quiz_questions",post_id:self.quiz_id}},processResults:function(e,n){return{results:t.map(e.items,function(t){return{text:t.name,id:t.id}}),pagination:{more:e.more}}}},cache:!0,placeholder:"Select a Question",multiple:!1,width:"100%"}),this},window.llms.metabox_quiz_settings=function(){t("#_llms_show_results").attr("checked")&&(t("#_llms_show_correct_answer").parent().parent().show(),t("#_llms_show_options_description_right_answer ").parent().parent().show(),t("#_llms_show_options_description_wrong_answer").parent().parent().show()),t("#_llms_show_results").on("change",function(){t("#_llms_show_results").attr("checked")?(t("#_llms_show_correct_answer").parent().parent().fadeIn(300),t("#_llms_show_options_description_right_answer ").parent().parent().fadeIn(300),t("#_llms_show_options_description_wrong_answer").parent().parent().fadeIn(300)):(t("#_llms_show_correct_answer").parent().parent().fadeOut(300),t("#_llms_show_options_description_right_answer ").parent().parent().fadeOut(300),t("#_llms_show_options_description_wrong_answer").parent().parent().fadeOut(300))})},window.llms.metabox_quiz_builder=function(){this.quiz_id=null,this.init=function(){this.bind(),this.bind_sortable(),this.set_total_points(),this.quiz_id=t("#post_ID").val()},this.bind=function(){var e=this,n=t("#llms-single-options");n.find(".llms-question select").llmsSelect2ify(),t(".llms-points").blur(function(t){t.preventDefault(),e.set_total_points()}),t("#add_new_question").on("click",function(n){n.preventDefault(),e.add_new_question(t(this))}),n.on("change",".llms-question-select",function(){var e=t(this);e.closest("tr.llms-question").attr("data-question-id",e.val())}),n.on("click",".llms-fa-edit",function(n){n.preventDefault(),window.open(e.get_question_edit_link(t(this).getQuestionId()))}),n.on("click",".llms-remove-question",function(n){t(this).closest("tr.llms-question").remove(),e.set_total_points()}),n.on("keyup",".llms-points",function(){e.set_total_points()}),n.on("select2:selecting","select",function(t){var n=t.params.args.data.id,s=e.get_selected_question_ids();-1!==s.indexOf(n)&&(t.preventDefault(),alert("You cannot select the same question more than once per quiz."))})},this.bind_sortable=function(){t(".question-list").sortable({axis:"y",cursor:"move",forcePlaceholderSize:!0,placeholder:"placeholder",items:".list_item",helper:function(e,n){var s=n.children(),i=n.clone();return i.children().each(function(e){t(this).width(s.eq(e).width())}),i},start:function(t,e){e.item.data("start_pos",e.item.index())}})},this.add_new_question=function(t){var e=this,n=e.get_question_html();n.find("select").llmsSelect2ify(),n.appendTo("#llms-single-options .question-list tbody").hide().fadeIn(300),this.set_total_points()},this.get_question_edit_link=function(t){var e=window.llms.admin_url+"post.php?action=edit&post="+t;return e},this.get_total_points=function(){var e=0;return t("#llms-single-options .llms-points").each(function(){e+=Number(t(this).val())}),e},this.get_total_questions=function(){return t("#llms-single-options tbody tr").length},this.get_question_html=function(){return t(t("#llms-single-question-template").html()).find("tr")},this.get_selected_question_ids=function(){var e=[];return t("#llms-single-options .llms-question").each(function(){var n=t(this).attr("data-question-id");n&&"0"!==n&&e.push(n)}),e},this.set_total_points=function(){t("#llms_points_total").text(this.get_total_points())},this.init()};new window.llms.metabox_quiz_builder,new window.llms.metabox_quiz_settings}(jQuery);